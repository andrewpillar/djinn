driver:
  type: qemu
  image: alpine/latest-stable
objects:
  - . => /root/some-dir
sources:
  - https://github.com/andrewpillar/jrnl v1.1.1
stages:
  - packages
  - build
  - test
jobs:
  - stage: packages
    commands:
      - echo "http://alpine.mirror.wearetriple.com/edge/community" >> /etc/apk/repositories
      - apk update
      - apk add musl-dev go
  - stage: build
    commands:
      - cd jrnl
      - go install
  - stage: test
    commands:
      - PATH="$PATH:$HOME/go/bin"
      - cd jrnl
      - ./test.sh
    artifacts:
      - /root/go/bin/jrnl => jrnl.out
